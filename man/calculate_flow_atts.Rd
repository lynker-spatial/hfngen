% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/flow-atts.R
\name{calculate_flow_atts}
\alias{calculate_flow_atts}
\title{Calculate flow-level hydraulic attributes by length-weighted aggregation}
\usage{
calculate_flow_atts(
  network,
  hydraulics,
  hf_id = "flowline_id",
  attribute_cols = c("owp_y_bf", "owp_tw_bf", "bf_area", "owp_roughness_bathy", "slope"),
  weight_col = "lengthkm"
)
}
\arguments{
\item{network}{A data frame/tibble containing at least:
\itemize{
\item \code{reference_id} (IDs that link to the attribute dataset),
\item \code{hl_class} and \code{hl_reference} (to extract gage references),
\item the grouping column given by \code{hf_id} (default: \code{"flowline_id"}),
\item and (optionally) other columns used downstream.
This is typically the \code{network} layer produced by your NextGen build.
}}

\item{hf_id}{Character name of the network flow identifier column to group by.
Defaults to \code{"flowline_id"}. Must be present in \code{network}.}

\item{attribute_cols}{Character vector of attribute column names to aggregate
(present in the Arrow dataset). Defaults to
\code{c('owp_y_bf','owp_tw_bf','bf_area','owp_roughness_bathy','slope')}.
These are averaged with a length-weighted mean.}

\item{weight_col}{Character name of the length-based weighting column present
in the Arrow dataset. Defaults to \code{"lengthkm"}.}

\item{hydraulics_path}{DuckDB connection via \code{hfutils::tbl_http()}
\itemize{
\item \code{feature_id} (will be mapped to \code{reference_id}),
\item the columns listed in \code{attribute_cols},
\item the weighting column named in \code{weight_col}.
}}
}
\value{
A tibble with one row per \code{hf_id} containing:
\itemize{
\item \code{{hf_id}}: the flow identifier
\item \code{BtmWdth}: estimated bottom width (m)
\item \code{TopWdth}: estimated top width (m)
\item \code{ChSlp}:  side slope (horizontal:vertical), floored at \code{1e-5}
\item \code{nCC}:    composite roughness (simple 2× \code{owp_roughness_bathy})
\item \code{So}:     channel slope (from \code{slope})
\item \code{TopWdthCC}: composite-channel top width (3× \code{TopWdth})
\item \code{Y}:      bankfull depth (from \code{owp_y_bf})
\item \code{hl_reference}: comma-separated gage references associated to the flow
}

All weighted means ignore \code{NA}s (\code{na.rm = TRUE}). Be sure the weighting column
(\code{weight_col}) reflects segment length in consistent units with your study.
}
\description{
Aggregates channel/hydraulic attributes from a feature-level attributes dataset
(served via \strong{Arrow}) up to a hydrologic flow identifier (e.g., \code{flowline_id})
using a length-based weighting column. The result returns common hydraulic
terms (bottom/top width, side slope, composite roughness, etc.) along with any
gage references attached to the flow.
}
\examples{
\dontrun{
# Arrow dataset (parquet directory) with feature_id, lengthkm, and OWP attributes
attr_path <- "s3://bucket/owp/channel_atts_parquet/"

# Network table produced earlier, with columns:
# reference_id, hl_class, hl_reference, flowline_id, ...
net <- readr::read_csv("network.csv")

atts <- calculate_flow_atts(
  network        = net,
  attribute_path = attr_path,
  hf_id          = "flowline_id",
  attribute_cols = c("owp_y_bf","owp_tw_bf","bf_area","owp_roughness_bathy","slope"),
  weight_col     = "lengthkm"
)
}

}
